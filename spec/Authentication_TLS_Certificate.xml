<?xml version="1.0" ?>
<node name="/Authentication_TLS_Certificate" xmlns:tp="http://telepathy.freedesktop.org/wiki/DbusSpec#extensions-v0">
  <tp:copyright>Copyright Â© 2010 Collabora Limited</tp:copyright>
  <tp:license>
    This library is free software; you can redistribute it and/or
modify it under the terms of the GNU Lesser General Public
License as published by the Free Software Foundation; either
version 2.1 of the License, or (at your option) any later version.

This library is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public
License along with this library; if not, write to the Free Software
Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
  </tp:license>

  <interface name="org.freedesktop.Telepathy.Authentication.TLSCertificate.DRAFT"
	     tp:causes-havoc="experimental">

    <tp:docstring>
      This object represents a TLS certificate.
    </tp:docstring>

    <tp:simple-type name="Certificate_Data" array-name="Certificate_Data_List"
		    type="ay">
      <tp:docstring>
	The raw data contained in a TLS certificate.
      </tp:docstring>
    </tp:simple-type>

    <tp:enum type="u" name="TLS_Certificate_State">
      <tp:docstring>
	The possible states for a <tp:dbus-ref
	namespace="org.freedesktop.Telepathy.Authentication">TLSCertificate.DRAFT</tp:dbus-ref>
	object.
      </tp:docstring>

      <tp:enumvalue suffix="None" value="0">
	<tp:docstring>
	  The certificate has no state associated with it.
	</tp:docstring>
      </tp:enumvalue>

      <tp:enumvalue suffix="Verified" value="1">
	<tp:docstring>
	  The certificate has been verified.
	</tp:docstring>
      </tp:enumvalue>

      <tp:enumvalue suffix="Rejected" value="2">
	<tp:docstring>
	  The certificate has been rejected.
	</tp:docstring>
      </tp:enumvalue>
    </tp:enum>

    <tp:enum type="u" name="TLS_Certificate_Reject_Reason">
      <tp:docstring>
	Possible reasons to reject a TLS certificate.
      </tp:docstring>

      <tp:enumvalue suffix="None" value="0">
	<tp:docstring>
	  No reason specified.
	</tp:docstring>
      </tp:enumvalue>

      <tp:enumvalue suffix="Other" value="1">
	<tp:docstring>
	  The certificate has been rejected for another reason
	  not listed in this enumeration.
	</tp:docstring>
      </tp:enumvalue>

      <tp:enumvalue suffix="Untrusted" value="2">
	<tp:docstring>
	  The certificate is not trusted.
	</tp:docstring>
      </tp:enumvalue>

      <tp:enumvalue suffix="Expired" value="3">
	<tp:docstring>
	  The certificate is expired.
	</tp:docstring>
      </tp:enumvalue>

      <tp:enumvalue suffix="Not_Activated" value="4">
	<tp:docstring>
	  The certificate is not active yet.
	</tp:docstring>
      </tp:enumvalue>

      <tp:enumvalue suffix="Fingerprint_Mismatch" value="5">
	<tp:docstring>
	  The certificate provided does not have the expected
	  fingerprint.
	</tp:docstring>
      </tp:enumvalue>

      <tp:enumvalue suffix="Hostname_Mismatch" value="6">
	<tp:docstring>
	  The hostname certified does not match the provided one.
	</tp:docstring>
      </tp:enumvalue>

      <tp:enumvalue suffix="Self_Signed" value="7">
	<tp:docstring>
	  The certificate is self-signed.
	</tp:docstring>
      </tp:enumvalue>

      <tp:enumvalue suffix="Revoked" value="8">
	<tp:docstring>
	  The certificate has been revoked.
	</tp:docstring>
      </tp:enumvalue>

      <tp:enumvalue suffix="Insecure_Algorithm" value="9">
	<tp:docstring>
	  The certificate uses an insecure cipher algorithm.
	</tp:docstring>
      </tp:enumvalue>
    </tp:enum>

    <property name="State" type="u" access="read"
	      tp:type="TLS_Certificate_State"
	      tp:name-for-bindings="State">
      <tp:docstring>
	The current state of this certificate.
	State change notifications happen by means of the
	<tp:member-ref>CertificateVerified</tp:member-ref> and
	<tp:member-ref>CertificateRejected</tp:member-ref> signals.
      </tp:docstring>
    </property>

    <property name="RejectReason" type="u" access="read"
	      tp:type="TLS_Certificate_Reject_Reason"
	      tp:name-for-bindings="Reject_Reason">
      <tp:docstring>
	The reason why this certificate has been rejected.
      </tp:docstring>
    </property>

    <property name="CertificateType" type="s" access="read"
	      tp:name-for-bindings="Certificate_Type">
      <tp:docstring>
	The type of this TLS certificate (e.g. 'x509' or 'pgp').
	<p>This property is immutable</p>
      </tp:docstring>
    </property>

    <property name="CertificateChainData" type="aay" access="read"
	      tp:type="Certificate_Data[]" tp:name-for-bindings="Certificate_Chain_Data">
      <tp:docstring>
	The RAW PEM-encoded trust chain of this TLS certificate.
	<p>This property is immutable.</p>
      </tp:docstring>
    </property>

    <signal name="CertificateVerified"
	    tp:name-for-bindings="Certificate_Verified">
      <tp:docstring>
	The state of this certificate has changed to Verified.
      </tp:docstring>
    </signal>

    <signal name="CertificateRejected"
	    tp:name-for-bindings="Certificate_Rejected">
      <tp:docstring>
	The state of this certificate has changed to Rejected.
      </tp:docstring>
      <arg name="Reason" type="u" tp:type="TLS_Certificate_Reject_Reason">
	<tp:docstring>
	  A value of the <tp:type>TLS_Certificate_Reject_Reason</tp:type>
	  enum explaining the reason why the certificate has been rejected.
	</tp:docstring>
      </arg>
      <arg name="Error" type="s" tp:type="DBus_Error_Name">
	<tp:docstring>
	  The name of a D-Bus error describing the error that
	  occurred, which may correspond to a 
	  <tp:type>TLS_Certificate_Reject_Reason</tp:type>.
	</tp:docstring>
      </arg>
      <arg name="Details" type="a{sv}" tp:type="String_Variant_Map">
	<tp:docstring>
	  A dictionary containing the additional information about the
	  error that has been given to the <tp:member-ref>Reject</tp:member-ref>
	  method.
	</tp:docstring>
      </arg>
    </signal>

    <method name="Accept" tp:name-for-bindings="Accept">
      <tp:docstring>
	Accepts this certificate, i.e. marks it as verified.
      </tp:docstring>
    </method>

    <method name="Reject" tp:name-for-bindings="Reject">
      <tp:docstring>
	Rejects this certificate.
      </tp:docstring>
      <arg direction="in" type="u" name="Reason"
	   tp:type="TLS_Certificate_Reject_Reason">
	<tp:docstring>
	  The reason why this certificate is being rejected.
	</tp:docstring>
      </arg>
      <arg direction="in" type="s" name="Error"
	   tp:type="DBus_Error_Name">
	<tp:docstring>
	  The name of a D-Bus error describing the error that
	  occurred, which may correspond to a
	  <tp:type>TLS_Certificate_Reject_Reason</tp:type>.
	</tp:docstring>
      </arg>
      <arg direction="in" type="a{sv}" name="Details"
	   tp:type="String_Variant_Map">
	<tp:docstring xmlns="http://www.w3.org/1999/xhtml">
	  <p> Additional information about the error, which MAY also include
	  one or more of the following well-known keys:</p>

	  <dl>
	    <dt>user-requested (b)</dt>
	    <dd>Whether the error was due to an user-requested rejectal of
	    the certificate, opposed to an unrecoverable error in the verification
	    process.</dd>
	    <dt>expected-hostname (s)</dt>
	    <dd>In case the certificate was rejected for an hostname mismatch,
	    this might contain the hostname expected to be certified.</dd>
	  </dl>

	</tp:docstring>
      </arg>
    </method>

  </interface>
</node>
