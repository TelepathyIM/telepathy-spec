<?xml version="1.0" ?>
<node name="/Connection_Interface_Contact_Capabilities" xmlns:tp="http://telepathy.freedesktop.org/wiki/DbusSpec#extensions-v0">
  <tp:copyright> Copyright (C) 2005, 2006 Collabora Limited </tp:copyright>
  <tp:copyright> Copyright (C) 2005, 2006 Nokia Corporation </tp:copyright>
  <tp:copyright> Copyright (C) 2006 INdT </tp:copyright>
  <tp:license xmlns="http://www.w3.org/1999/xhtml">
    <p>This library is free software; you can redistribute it and/or
modify it under the terms of the GNU Lesser General Public
License as published by the Free Software Foundation; either
version 2.1 of the License, or (at your option) any later version.</p>

<p>This library is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
Lesser General Public License for more details.</p>

<p>You should have received a copy of the GNU Lesser General Public
License along with this library; if not, write to the Free Software
Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</p>
  </tp:license>
  <interface name="org.freedesktop.Telepathy.Connection.Interface.ContactCapabilities.DRAFT">
    <tp:requires interface="org.freedesktop.Telepathy.Connection"/>

    <tp:docstring xmlns="http://www.w3.org/1999/xhtml">
      <p>An interface for connections where it is possible to know what channel
        types may be created before the request is made to the connection
        object. Each capability represents a commitment by the connection
        manager that it will ordinarily be able to create a channel when given
        a request with the given type and handle.</p>

      <p>Capabilities pertain to particular contact handles, and represent
        activities such as having a text chat or a voice call with the user.
        The activities are represented by the D-Bus interface name of the
        channel type for that activity, and channel properties which can be
        requested.</p>

      <p>This interface also provides for user interfaces notifying the
        connection manager of what capabilities to advertise for the user. This
        is done by using the AdvertiseContactCapabilities method, and deals with
        the interface names of channel types and the channel properties values 
        pertaining to them which are implemented by available client
        processes.</p>

    </tp:docstring>

    <method name="AdvertiseContactCapabilities">
      <arg direction="in" name="add" type="aa{sv}"
           tp:type="String_Variant_Map[]">
        <tp:docstring xmlns="http://www.w3.org/1999/xhtml">
          An array of channel classes to add to the list of what the connection
          can handle
        </tp:docstring>
      </arg>
      <arg direction="in" name="remove" type="aa{sv}"
           tp:type="String_Variant_Map[]">
        <tp:docstring>
          An array of channel classes to remove from the list of what the
          connection can handle
        </tp:docstring>
      </arg>
      <arg direction="out" type="aa{sv}" tp:type="String_Variant_Map[]">
        <tp:docstring>
          An array of channel classes describing the current capabilities.
        </tp:docstring>
      </arg>
      <tp:docstring xmlns="http://www.w3.org/1999/xhtml">
        <p>Used by user interfaces to indicate which channel types they are able
        to handle on this connection. Because these may be provided by
        different client processes, this method accepts channel types to add
        and remove from the set already advertised on this connection.</p>

        <p>Upon a successful invocation of this method, the
        ContactCapabilitiesChanged signal will be emitted for the user's own
        handle (as returned by GetSelfHandle) by the connection manager to
        indicate the changes that have been made.  This signal should also be
        monitored to ensure that the set is kept accurate - for example, a
        client may remove capabilities when it exits which are still provided
        by another client.</p>
      </tp:docstring>
      <tp:possible-errors>
        <tp:error name="org.freedesktop.Telepathy.Error.NetworkError"/>
        <tp:error name="org.freedesktop.Telepathy.Error.Disconnected"/>
      </tp:possible-errors>
    </method>

    <method name="GetContactCapabilities">
      <arg direction="in" name="handles" type="au" tp:type="Contact_Handle[]">
        <tp:docstring xmlns="http://www.w3.org/1999/xhtml">
          <p>An array of contact handles for this connection.</p>

          <p>The handle zero MUST NOT be included in the request.</p>
        </tp:docstring>
      </arg>
      <arg direction="out" type="a(ua{sv}as)"
           tp:type="Enhanced_Contact_Capability[]">
        <tp:docstring xmlns="http://www.w3.org/1999/xhtml">
          An array of structures containing:
          <ul>
            <li>a dictionary mapping the channel properties to their values.</li>
            <li>an array of additional allowed properties</li>
          </ul>
        </tp:docstring>
      </arg>
      <tp:docstring>
        Returns an array of enhanced capabilities for the given contact handles.
      </tp:docstring>
      <tp:possible-errors>
        <tp:error name="org.freedesktop.Telepathy.Error.NetworkError"/>
        <tp:error name="org.freedesktop.Telepathy.Error.Disconnected"/>
        <tp:error name="org.freedesktop.Telepathy.Error.InvalidHandle">
          <tp:docstring>
            The handle does not represent a contact. Zero is always invalid.
          </tp:docstring>
        </tp:error>
        <tp:error name="org.freedesktop.Telepathy.Error.PermissionDenied"/>
      </tp:possible-errors>
    </method>

    <signal name="ContactCapabilitiesChanged">
      <arg name="caps" type="(a(ua{sv}as)a(ua{sv}as))" tp:type="Contact_Capability_Change">
        <tp:docstring xmlns="http://www.w3.org/1999/xhtml">
          An struct containing:
          <ul>
            <li>the contact's removed capabilities</li>
            <li>the contact's added capabilities</li>
          </ul>
        </tp:docstring>
      </arg>
      <tp:docstring xmlns="http://www.w3.org/1999/xhtml">
        <p>Announce that there has been a change of capabilities on the
          given handle.</p>
      </tp:docstring>
    </signal>

    <tp:struct name="Enhanced_Contact_Capability" array-name="Enhanced_Contact_Capability_List">
      <tp:docstring>
        A struct representing a capability posessed by a contact,
        as returned by GetContactCapabilities on the ContactCapabilities
        interface. The channel creation will succeed if the request contains
        all the Fixed_Properties will the values specified in this struct. The
        request can contain additional properties from Allowed_Properties. If
        the request contains a property which does not belong to
        Fixed_Properties nor to Allowed_Properties, the request will fail.
      </tp:docstring>
      <tp:member type="u" tp:type="Contact_Handle" name="Handle"/>
      <tp:member type="a{sv}" tp:type="String_Variant_Map"
                 name="Fixed_Properties">
        <tp:docstring>
          A dictionary mapping the channel properties to their values.
        </tp:docstring>
      </tp:member>
      <tp:member type="as" name="Allowed_Properties">
        <tp:docstring>
          An array of additional allowed properties.
        </tp:docstring>
      </tp:member>
    </tp:struct>

    <tp:struct name="Contact_Capability_Change" array-name="Contact_Capability_Change_List">
      <tp:docstring>A struct representing a change to one of a contact's capabilities, as
        seen in the ContactCapabilitiesChanged signal on the ContactCapabilities
        interface.</tp:docstring>
      <tp:member type="a(ua{sv}as)" tp:type="Enhanced_Contact_Capability[]"
                 name="Removed_Capabilities"/>
      <tp:member type="a(ua{sv}as)" tp:type="Enhanced_Contact_Capability[]"
                 name="Added_Capabilities"/>
    </tp:struct>

  </interface>
</node>
<!-- vim:set sw=2 sts=2 et ft=xml: -->
